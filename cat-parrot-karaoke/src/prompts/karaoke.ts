/**
 * Промпт для генерации караоке через OpenAI
 * 
 * Создает детальный промпт с инструкциями для AI:
 * - Требования к рифмовке (AABB)
 * - Структура JSON ответа
 * - Стиль и содержание песни
 * - Исторический контекст
 * - Логический анализ совместимости для расчета friendship score (0-100)
 * 
 * Логика расчета friendship score основана на 4 факторах:
 * 1. Совместимость имен (фонетическая гармония, длина, стиль)
 * 2. Сочетаемость эпохи и жанра
 * 3. Качество дуэта в песне (синхронность, гармония)
 * 4. Общее впечатление от выступления
 * 
 * @param catName - Имя кота
 * @param parrotName - Имя попугая
 * @param era - Выбранная эпоха
 * @param genre - Выбранный жанр
 * @returns Промпт для отправки в OpenAI API
 */
export function generateKaraokePrompt(
  catName: string,
  parrotName: string,
  era: string,
  genre: string
): string {
  return `
      Ты — древний бард и мастер караоке, который сочиняет простые, смешные и ЧЁТКО РИФМУЮЩИЕСЯ песни для дуэта кота и попугая в разных эпохах.

      Вводные данные:
      Кот: ${catName}
      Попугай: ${parrotName}
      Эпоха: ${era}
      Жанр песни: ${genre}

      ЗАДАЧА: верни ОДИН объект строго в формате JSON (БЕЗ Markdown, без комментариев), со следующими полями верхнего уровня:
      "song"
      "vocalStyle"
      "lore"
      "friendship"

      1. Поле "song"
      "song" — объект с двумя полями: "verse" и "chorus".
      "verse" — это куплет из РОВНО 4 СТРОК.
      Требования к куплету:
      Рифмовка СТРОГО AABB:
      строка 1 рифмуется со строкой 2 (похожие окончания, слышная рифма);
      строка 3 рифмуется со строкой 4.
      Каждая строка на отдельной строке, без нумерации, без кавычек внутри.
      Язык: РУССКИЙ.
      Стиль: простой, ритмичный, караоке-френдли, юморной.
      В куплете ОБЯЗАТЕЛЬНО явно фигурируют:
      имя кота (${catName});
      имя попугая (${parrotName});
      отсылки к выбранной эпохе (${era}) и жанру (${genre}).
      НЕ использовать слишком сложные, редкие или ломанные слова, рифма должна быть естественной и «слышимой».
      Избегать неточных рифм: "кот" – "грядёт" плохо; "кот" – "живот" хорошо.
      "chorus" — припев из РОВНО 4 СТРОК.
      Требования к припеву:
      Рифмовка СТРОГО AABB:
      строка 1 рифмуется со строкой 2;
      строка 3 рифмуется со строкой 4.
      Каждая строка — отдельная строка.
      Припев должен быть более «залипучим» и повторяемым, можно использовать имена персонажей, эпоху, жанровые клише (для попа, рока, рэпа, оперы и т.д.).
      Ритм и лексика — простые, чтобы это хотелось подпевать.

      Формат поля "song":

      "song": {
        "verse": "СТРОКА 1\\nСТРОКА 2\\nСТРОКА 3\\nСТРОКА 4",
        "chorus": "СТРОКА 1\\nСТРОКА 2\\nСТРОКА 3\\nСТРОКА 4"
      }

      2. Поле "vocalStyle"
      "vocalStyle" — ОДНА короткая смешная фраза-описание, как звучит выступление.
      Требования:
      1–2 простых предложения.
      Можно использовать метафоры и сравнения: шаманские барабаны, рок-ария, древний речитатив, попсовый припев у костра и т.п.
      Упомяни обоих: и кота, и попугая.
      Пример стиля (НЕ КОПИРОВАТЬ, а ориентир по духу): «Кот рычит как древний рок-бард, а попугай сверху льёт попсовый автотюн».

      3. Поле "lore"
      "lore" — псевдо-историческая справка о том, как такая песня могла существовать в выбранной древней цивилизации.
      Требования:
      2–4 предложения.
      Обязательно упомянуть выбранную эпоху (${era}) и связать её с песней (ритуал, праздник, таверна, храм, рыцарский турнир, пирамида, пещера и т.п.).
      Тон: юмористический псевдо-научный, как «легенда, которую рассказывает местный сказитель».

      4. Поле "friendship"
      "friendship" — объект с уровнем дружбы после выступления.

      Структура:

      "friendship": {
        "score": ЧИСЛО,
        "reason": "строка с объяснением"
      }

      ВАЖНО: "score" должен быть рассчитан на основе ЛОГИЧЕСКОГО АНАЛИЗА совместимости, а не случайным числом.
      Ты должен проанализировать следующие аспекты и обосновать score:

      А) СОВМЕСТИМОСТЬ ИМЕН (${catName} и ${parrotName}):
      - Фонетическая гармония: как имена звучат вместе (мягкие/резкие звуки, ритм, созвучие)
      - Длина имен: баланс между короткими и длинными именами
      - Стиль имен: "древние" имена vs "современные", серьезные vs игривые
      - Примеры:
        * Высокая совместимость (15-20 очков): "Барсик" и "Кеша" — короткие, звучные, игривые
        * Средняя совместимость (8-12 очков): "Аммон-Ра" и "Попка" — контраст стилей, но работает
        * Низкая совместимость (0-5 очков): слишком длинные или диссонансные имена

      Б) СОЧЕТАЕМОСТЬ ЭПОХИ И ЖАНРА (${era} + ${genre}):
      - Насколько выбранная эпоха и жанр подходят друг другу исторически и стилистически
      - Насколько комбинация создает интересный, смешной или гармоничный эффект
      - Примеры:
        * Высокая сочетаемость (15-20 очков): "Средневековье" + "Опера" — логично и эффектно
        * Средняя сочетаемость (8-12 очков): "Каменный век" + "Рок" — смешно, но работает
        * Низкая сочетаемость (0-5 очков): "Древний Египет" + "Рэп" — слишком диссонансно

      В) КАЧЕСТВО ДУЭТА В ПЕСНЕ:
      - Синхронность: как кот и попугай взаимодействуют в тексте (поддерживают друг друга или перебивают)
      - Гармония: есть ли в тексте ощущение совместного выступления или хаоса
      - Распределение ролей: кто ведет, кто подпевает, есть ли баланс
      - Примеры:
        * Идеальный дуэт (25-30 очков): имена органично вплетены, есть взаимодействие, гармония
        * Хороший дуэт (15-20 очков): есть синхронность, но небольшие промахи
        * Слабый дуэт (5-10 очков): персонажи "перебивают" друг друга, нет гармонии
        * Провальный дуэт (0-5 очков): полная какофония, нет взаимодействия

      Г) ОБЩЕЕ ВПЕЧАТЛЕНИЕ ОТ ВЫСТУПЛЕНИЯ:
      - Атмосфера: веселая, драматичная, эпичная, комичная
      - Целостность: насколько все элементы (имена, эпоха, жанр, текст) работают вместе
      - Запоминаемость: насколько выступление выделяется
      - Примеры:
        * Впечатляющее выступление (15-20 очков): все элементы идеально сочетаются, создают целостную картину
        * Хорошее выступление (8-12 очков): есть небольшие недочеты, но общее впечатление положительное
        * Слабое выступление (0-5 очков): элементы не сочетаются, общее впечатление негативное

      ПРИМЕРЫ ЛОГИКИ РАСЧЕТА ОЧКОВ:

      Пример 1 (Высокий score 85-95):
      - Имена "Барсик" и "Кеша" отлично сочетаются (+18)
      - "Средневековье" + "Баллада" — идеальная комбинация (+20)
      - В тексте песни дуэт гармоничен, персонажи поддерживают друг друга (+28)
      - Общее впечатление: эпичное, целостное, запоминающееся (+18)
      - ИТОГО: ~84-86 очков

      Пример 2 (Средний score 45-55):
      - Имена "Аммон-Ра" и "Попка" — контрастный стиль, но работает (+10)
      - "Каменный век" + "Рок" — смешно, но не очень логично (+8)
      - В тексте есть синхронность, но небольшие промахи (+15)
      - Общее впечатление: забавное, но не идеальное (+12)
      - ИТОГО: ~45-48 очков

      Пример 3 (Низкий score 15-25):
      - Имена слишком длинные и диссонансные (+3)
      - "Древний Египет" + "Рэп" — полная несовместимость (+2)
      - В тексте персонажи перебивают друг друга, нет гармонии (+5)
      - Общее впечатление: хаотичное, несбалансированное (+3)
      - ИТОГО: ~13-15 очков

      Требования к полю "friendship":
      "score" — целое число от 0 до 100, рассчитанное на основе вышеуказанных факторов.
      "reason" — 1–2 предложения, которые ОБЯЗАТЕЛЬНО объясняют логику расчета:
      - Упомяни конкретные факторы (совместимость имен, сочетаемость эпохи/жанра, качество дуэта)
      - Объясни, почему именно такой score
      - Можно использовать формулировки «Дружба 85» или «Дружба 23» внутри reason, но ЧИСЛО в поле "score" обязательно должно соответствовать смыслу
      - Пример хорошего reason: "Имена Барсик и Кеша прекрасно сочетаются, а комбинация Средневековья с Балладой создала идеальный дуэт — их голоса слились в гармоничном выступлении. Дружба 87."
      - Пример плохого reason (НЕ ДЕЛАТЬ): "Они спели хорошо. Дружба 50." — нет объяснения логики

      ЖЁСТКИЕ ОГРАНИЧЕНИЯ
      Ответ ДОЛЖЕН быть СТРОГО валидным JSON-объектом верхнего уровня:
      {
        "song": { ... },
        "vocalStyle": "...",
        "lore": "...",
        "friendship": { ... }
      }

      Без лишних полей, без комментариев, без Markdown, без пояснений.
      РИФМА ОБЯЗАТЕЛЬНА:
      В "verse": рифмовка ровно AABB.
      В "chorus": рифмовка ровно AABB.
      Рифма должна быть чёткой: похожие окончания слов, слышимое созвучие, а не только общий смысл.
      Перед тем как вернуть ответ, ПРОВЕРЬ:
      что каждая пара строк (1–2 и 3–4 в куплете и припеве) действительно рифмуется на слух;
      что имена ${catName} и ${parrotName}, эпоха ${era} и жанр ${genre} действительно упомянуты хотя бы один раз в песне (куплет или припев).
      Язык всего ответа (включая song, vocalStyle, lore, friendship.reason): строго русский.
    `;
}

