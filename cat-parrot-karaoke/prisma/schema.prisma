// Prisma Schema для Cat & Parrot Ancient Karaoke
// 
// Модели данных:
// - User: пользователи приложения
// - Generation: сгенерированные караоке-хиты
// - LeaderboardEntry: записи лидерборда

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String      @id @default(uuid()) @map("id")
  email     String      @unique @map("email")
  createdAt DateTime    @default(now()) @map("created_at")
  updatedAt DateTime    @updatedAt @map("updated_at")
  
  generations Generation[]
  leaderboardEntries LeaderboardEntry[]

  @@map("users")
}

model Generation {
  id             String   @id @default(uuid()) @map("id")
  userId         String   @map("user_id")
  promptData     Json     @map("prompt_data") // Данные запроса (catName, parrotName, era, genre)
  resultText     String   @map("result_text") // Текст сгенерированной песни
  friendshipScore Int      @map("friendship_score") // Очки дружбы (0-100)
  createdAt      DateTime @default(now()) @map("created_at")
  
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  leaderboardEntry LeaderboardEntry?

  @@map("generations")
}

model LeaderboardEntry {
  id           String     @id @default(uuid()) @map("id")
  userId       String     @map("user_id")
  generationId String     @unique @map("generation_id")
  score        Int        @map("score") // Очки дружбы из Generation
  createdAt    DateTime   @default(now()) @map("created_at")
  
  user         User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  generation   Generation @relation(fields: [generationId], references: [id], onDelete: Cascade)

  @@index([score])
  @@index([createdAt])
  @@map("leaderboard_entries")
}

